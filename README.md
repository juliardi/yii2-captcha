Yii2 Captcha Extension
======================

[![Latest Stable Version](https://img.shields.io/packagist/v/juliardi/yii2-captcha?label=stable)](https://packagist.org/packages/juliardi/yii2-captcha)
[![Total Downloads](https://img.shields.io/packagist/dt/juliardi/yii2-captcha)](https://packagist.org/packages/juliardi/yii2-captcha)
[![Latest Stable Release Date](https://img.shields.io/github/release-date/juliardi/yii2-captcha)](https://github.com/juliardi/yii2-captcha)
[![License](https://img.shields.io/github/license/juliardi/yii2-captcha)](https://github.com/juliardi/yii2-captcha)

> Yii2 Captcha uses [Gregwar's Captcha library](https://github.com/Gregwar/Captcha) wrapper for Yii2.

## Table of Contents

- [Yii2 Toastr](#yii2-toastr)
  - [Table of Contents](#table-of-contents)
  - [Instalation](#instalation)
  - [Dependencies](#dependencies)
  - [Usage](#usage)
    - [Layouts/Views](#layoutsviews)
      - [Layouts/Views Simple Usage](#layoutsviews-simple-usage)
      - [Layouts/Views Advanced Usage](#layoutsviews-advanced-usage)
    - [Controllers](#controllers)
      - [Controllers Simple Usage](#controllers-simple-usage)
      - [Controllers Advanced Usage (\< v1.4.0)](#controllers-advanced-usage--v140)
      - [Controllers Advanced Usage With Override Toastr Options (â‰¥ v1.4.0)](#controllers-advanced-usage-with-override-toastr-options--v140)

## Instalation

Package is available on [Packagist](https://packagist.org/packages/juliardi/yii2-captcha), you can install it using [Composer](https://getcomposer.org).

```shell
composer require juliardi/yii2-captcha "*"
```

or add to the require section of your `composer.json` file.

```shell
"juliardi/yii2-captcha": "*"
```

## Usage

**Captcha renders a CAPTCHA image and an input field that takes user-entered verification code.**

Captcha is used together with `juliardi\captcha\CaptchaAction` to provide [CAPTCHA](https://en.wikipedia.org/wiki/CAPTCHA) - a way of preventing website spamming.

The image element rendered by Captcha will display a CAPTCHA image generated by an action whose route is specified by `$captchaAction`. This action must be an instance of `juliardi\captcha\CaptchaAction`.

When the user clicks on the CAPTCHA image, it will cause the CAPTCHA image to be refreshed with a new CAPTCHA.

You may use `juliardi\captcha\CaptchaValidator` to validate the user input matches the current CAPTCHA verification code.

### Action

Add the following method into your Controller.

```php
public function actions()
{
    return [
        'captcha' => [
            'class' => 'juliardi\captcha\CaptchaAction',
            //'length' => 5, // captcha character count or [2, 5] for random length
            //'width' => 150, // width of generated captcha image
            //'height' => 40, // height of generated captcha image
            //'quality' => 100, // quality of generated captcha image
        ],
    ];
}
```

Some configurable attributes are :

- `length`
An integer value to set the generated CAPTCHA character count
- `width`
An integer value to set the width of generated CAPTCHA image
- `height`
An integer value to set the height of generated CAPTCHA image
- `quality`
An integer value to set the quality of generated CAPTCHA image

### View file

Add the following code to your view to render CAPTCHA image and input.

The following example shows how to use this widget with a model attribute:

```php
use juliardi\captcha\Captcha;

echo Captcha::widget([
    'model' => $model,
    'attribute' => 'captcha',
]);
```

The following example will use the name property instead:

```php
use juliardi\captcha\Captcha;

echo Captcha::widget([
    'name' => 'captcha',
]);
```

You can also use this widget in an [ActiveForm](https://www.yiiframework.com/doc/api/2.0/yii-widgets-activeform) using the [widget()](https://www.yiiframework.com/doc/api/2.0/yii-widgets-activefield#widget()-detail) method, for example like this:

```php
<?= $form->field($model, 'captcha')->widget(\juliardi\captcha\Captcha::classname(), [
    // configure additional widget properties here
]) ?>
```

Some configurable attributes are :

- `captchaAction`
Captcha action, default to `site/captcha`
- `template`
Template for rendering CAPTCHA image and input. In this template, the token `{image}` will be replaced with the actual image tag, while `{input}` will be replaced with the text input tag.
- `options`
the HTML attributes for the input tag.

### Validation

Add the following rule to your model to validate the captcha input :

```php
use juliardi\captcha\CaptchaValidator;
...
public function rules()
{
    return [
        ... some other rules...
        ['captcha', CaptchaValidator::className()],
    ];
}
```
